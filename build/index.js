module.exports=function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=25)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.redisInstance=void 0;var o=r(3),u=n(o),i=r(23),s=n(i),c=r(1);u.default.connect(c.DATABASE_URL);var a=u.default.connection;a.on("error",console.error.bind(console,"connection error:")),a.once("open",function(e){console.log("db connected")});t.redisInstance=s.default.createClient();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(20).config();t.SECRET=process.env.SECRET||"fd123@#423fdsa54234f6gtredhg",t.DATABASE_URL=process.env.DB_URL||"mongodb://localhost:27017/icomrade"},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("ramda")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkAdmin=t.checkAuthSocket=t.checkAuth=void 0;var n=r(7),o=function(e){return e&&e.__esModule?e:{default:e}}(n),u=r(0),i=r(6),s=r(1);t.checkAuth=function(e,t,r){var n=e.headers["x-access-token"];if(!n)return(0,i.unAuthorizeUser)(t);u.redisInstance.sismember("logOutTokens",n,function(u,s){if(u)throw u;if(s)return(0,i.unAuthorizeUser)(t);o.default.verify(n,e.app.get("secret"),function(n,o){if(n)return(0,i.unAuthorizeUser)(t);e.currentUser=o,r()})})},t.checkAuthSocket=function(e,t){var r=e.request._query.token;r&&o.default.verify(r,s.SECRET,function(r,n){return r?void 0:(e.currentUser=n,t())})},t.checkAdmin=function(e,t,r){return e.currentUser&&"ROLE_ADMIN"===e.currentUser.role?r():t.status(403).json({message:"Forbidden"})}},function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.getToken=t.unAuthorizeUser=t.buildQueryOpts=void 0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(4),s=(t.buildQueryOpts=function(e){if((0,i.isEmpty)(e))return{};var t=e.location,r=e.bedrooms,n=e.bathrooms,o=e.maxArea,u=e.maxPrice,c=e.minArea,a=e.minPrice,f=e.parking;return s({city:t,bedrooms:r,bathrooms:n,price:{$gte:a,$lte:u},lotSizeSqFt:{$gte:c,$lte:o},parkingType:"yes"===f?{$exists:!0}:"no"===f?{$exists:!1}:{}})},function e(t){return(0,i.keys)(t).reduce(function(r,s){if(void 0===t[s])return r;if("object"===u(t[s])){var c=e(t[s]);return(0,i.isEmpty)(c)?r:o({},r,n({},s,c))}return o({},r,n({},s,t[s]))},{})});t.unAuthorizeUser=function(e){return e.status(401).json({success:!1,message:"Failed to authenticate token."})},t.getToken=function(e){return e.headers["x-access-token"]}},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),u=n(o),i=r(18),s=n(i),c=r(19),a=n(c),f=r(24),d=n(f),l=r(22),m=n(l),p=r(21),v=n(p),O=r(11),h=n(O),_=r(16),b=r(5),y=r(1),g=(0,u.default)(),R=v.default.Server(g),M=(0,d.default)(R);g.use((0,m.default)("dev")),g.set("secret",y.SECRET),g.use(s.default.urlencoded({extended:!0})),g.use(s.default.json()),g.use((0,a.default)()),g.set("view engine","ejs"),g.set("views",__dirname+"/views"),g.use("/api",h.default),g.get("/",function(e,t){t.render("index")}),g.get("/dashboard",function(e,t){t.render("index")}),g.use(function(e,t,r,n){console.log("Error happens ",e.stack)});M.use(b.checkAuthSocket),M.on("connection",(0,_.mainHandler)(M)),g.use("/public",u.default.static(__dirname+"/views/"));var x=process.env.PORT||8e3;R.listen(x,function(e){console.log("listening on *:"+x)}),t.default=R},function(e,t){e.exports=require("babel-polyfill")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,u){try{var i=t[o](u),s=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(2),i=r(7),s=n(i),c=r(4),a=n(c),f=r(14),d=n(f),l=r(5),m=r(0),p=r(6),v=(0,u.Router)();v.post("/login",function(){var e=o(regeneratorRuntime.mark(function e(t,r,n){var o,u,i,c,f,l,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.body,u=o.username,i=o.password,console.log(u,i),e.prev=2,e.next=5,d.default.findOne({username:u});case 5:if(c=e.sent){e.next=8;break}throw{message:"Your credentials is not right!"};case 8:return e.next=10,c.comparePassword(i);case 10:if(f=e.sent){e.next=13;break}throw{message:"Your credentials is not right!"};case 13:return l=a.default.omit(["password"],c.toObject()),m=s.default.sign(l,t.app.get("secret"),{expiresIn:"30m"}),r.setHeader("x-access-token",m),e.abrupt("return",r.json(l));case 19:e.prev=19,e.t0=e.catch(2),console.log(e.t0),r.status(401).json(e.t0);case 23:case"end":return e.stop()}},e,void 0,[[2,19]])}));return function(t,r,n){return e.apply(this,arguments)}}()),v.post("/signup",function(){var e=o(regeneratorRuntime.mark(function e(t,r,n){var o,u,i,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.body,u=o.username,i=o.password,e.prev=1,e.next=4,d.default.findOne({username:u});case 4:if(!(s=e.sent)){e.next=7;break}return e.abrupt("return",r.status(409).json({err:"Username already exists!"}));case 7:c=new d.default({username:u,password:i}),c.save(function(e){e&&r.send(e),r.json({message:"Account created!"})}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),r.status(500).send(e.t0);case 14:case"end":return e.stop()}},e,void 0,[[1,11]])}));return function(t,r,n){return e.apply(this,arguments)}}()),v.get("/currentUser",l.checkAuth,function(e,t,r){t.json(e.currentUser)}),v.get("/logout",function(e,t){var r=(0,p.getToken)(e);m.redisInstance.sadd(["logOutTokens",r],function(e,r){if(e)throw e;return t.json({message:"LOG_OUT"})})}),t.default=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),o=r(10),u=function(e){return e&&e.__esModule?e:{default:e}}(o),i=(0,n.Router)();i.use("/auth",u.default),t.default=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(4),c=n(s),a=r(13),f=n(a),d=null,l=function(){function e(){var t=this;return u(this,e),d||(d=this,this.resources={},this.addRoom=this.addRoom.bind(this),f.default.getAll().then(function(e){return e.forEach(function(e){return t.resources[e.name]=[]})})),d}return i(e,[{key:"getAllResources",value:function(){return this.resources}},{key:"addRoom",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise(function(n,o){new f.default({name:e,description:r}).save(function(r){r&&o(r),t.resources[e]=t.resources[e]||[],n("Added")})})}},{key:"removeRoom",value:function(e){var t=this;return new Promise(function(r,n){f.default.findOneAndRemove({name:e},function(o){if(o)return void n(o);t.resources=c.default.omit([e],t.resources),r("Done")})})}},{key:"getRoom",value:function(e){return this.resources[e]}},{key:"addMemberToRoom",value:function(e,t){var r=this.resources[e];return c.default.find(function(e){return e.id===t.id},r)?(console.warn("This member already exist"),!1):(this.resources[e].push(t),!0)}},{key:"removeMemberFromRoom",value:function(e,t){this.resources[e]&&(this.resources[e]=c.default.filter(function(e){return e.id!==t.id},this.resources[e]))}},{key:"getMembersAfterSpecificMember",value:function(e,t){var r=this.resources[e].map(function(e){return e.id}).indexOf(t.id);return this.resources[e].filter(function(e,t){return t>r})}},{key:"getAllRoomStatus",value:function(){var e=this;return c.default.keys(this.resources).reduce(function(t,r){return Object.assign(t,o({},r,e.resources[r].length))},{})}}]),e}();t.default=l},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),u=n(o),i=r(0),s=(n(i),u.default.Schema({name:{type:String,unique:!0},description:String})),c=u.default.model("Room",s);c.getAll=function(){var e=this;return new Promise(function(t,r){e.find({},function(e,n){e&&r(e),t(n)})})},t.default=c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),u=n(o),i=r(17),s=n(i),c=r(0),a=(n(c),u.default.Schema({username:{type:String,required:!0,unique:!0},password:{type:String,required:!0},role:{type:String,default:"ROLE_USER"},created_at:{type:Date,default:Date.now}}));a.pre("save",function(e){var t=this;s.default.hash(t.password,null,null,function(r,n){r&&e(),t.password=n,e()})}),a.methods.comparePassword=function(e){var t=this;return new Promise(function(r,n){s.default.compare(e,t.password,function(e,t){e&&n(e),r(t)})})},t.default=u.default.model("user",a)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GET_ROOM="GET_ROOM",t.CREATE_ROOM="CREATE_ROOM",t.REMOVE_ROOM="REMOVE_ROOM",t.BOOK_ROOM="BOOK_ROOM",t.FINISH_ROOM="FINISH_ROOM",t.CANCEL_ROOM="CANCEL_ROOM",t.UPDATE_ROOM_INFO="UPDATE_ROOM_INFO"},function(e,t,r){"use strict";function n(e){return function(t){var r=function(){var t=s.getAllRoomStatus();e.sockets.emit(i.UPDATE_ROOM_INFO,t)};t.on(i.GET_ROOM,function(){r()}),t.on(i.CREATE_ROOM,function(e){s.addRoom(e).then(r)}),t.on(i.REMOVE_ROOM,function(e){s.removeRoom(e).then(r)}),t.on(i.BOOK_ROOM,function(e){s.addMemberToRoom(e,t),t.join(e),t.emit(i.BOOK_ROOM,{roomName:e,queueNumber:s.getRoom(e).length-1}),r()}),t.on(i.FINISH_ROOM,function(n){s.removeMemberFromRoom(n,t),e.to(n).emit(i.FINISH_ROOM,{roomName:n}),r()}),t.on(i.CANCEL_ROOM,function(e){var n=s.getMembersAfterSpecificMember(e,t);s.removeMemberFromRoom(e,t);var o=!0,u=!1,c=void 0;try{for(var a,f=n[Symbol.iterator]();!(o=(a=f.next()).done);o=!0){a.value.emit(i.FINISH_ROOM,{roomName:e})}}catch(e){u=!0,c=e}finally{try{!o&&f.return&&f.return()}finally{if(u)throw c}}t.emit(i.CANCEL_ROOM,{roomName:e}),r()})}}Object.defineProperty(t,"__esModule",{value:!0}),t.mainHandler=n;var o=r(12),u=function(e){return e&&e.__esModule?e:{default:e}}(o),i=r(15),s=new u.default},function(e,t){e.exports=require("bcrypt-nodejs")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("redis")},function(e,t){e.exports=require("socket.io")},function(e,t,r){r(9),e.exports=r(8)}]);